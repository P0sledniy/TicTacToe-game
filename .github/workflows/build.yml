name: Build APK
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-22.04  # –Ø–í–ù–û –£–ö–ê–ó–´–í–ê–ï–ú –°–¢–ê–†–£–Æ –í–ï–†–°–ò–Æ UBUNTU!
    timeout-minutes: 120

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: üêç Set up Python 3.9
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'  # Python 3.9 —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –¥–ª—è —Å–±–æ—Ä–∫–∏

      - name: ‚öôÔ∏è Install OLD System Dependencies
        run: |
          sudo apt-get update -qq
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ö–û–ù–ö–†–ï–¢–ù–´–ï –°–¢–ê–†–´–ï –≤–µ—Ä—Å–∏–∏
          sudo apt-get install -y -qq \
            python3-pip python3-dev git unzip wget \
            openjdk-8-jdk-headless \
            build-essential libffi-dev libssl-dev \
            autoconf=2.69* automake=1.16* libtool=2.4* pkg-config

      - name: üì¶ Install Buildozer & Cython
        run: |
          pip3 install --upgrade "pip<24.0" wheel setuptools
          pip3 install buildozer cython==0.29.33

      - name: üèóÔ∏è Build APK (Single arch - faster)
        run: |
          # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
          export FFI_CONFIGURE_BUILD_FROM_SOURCE=false
          export ACLOCAL_PATH=/usr/share/aclocal
          # –°–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è ARM64
          yes | buildozer android debug 2>&1 | tail -100

      - name: üì§ Upload APK Artifact
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: tictactoe-apk
          path: bin/*.apk
